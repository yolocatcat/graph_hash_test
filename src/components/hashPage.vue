<template>
  <div class="panel-div">
    <div class="head">
      <h1>ğŸŒˆB20</h1>
      <p>
        STEP1.è¾“å…¥ä¸€ç»„æ•°æ®:æ ¹æ®ç”¨æˆ·è¾“å…¥çš„æ•°æ®åˆ›å»ºä¸€ä¸ªè´Ÿè½½å› å­ä¸º0.7çš„å“ˆå¸Œè¡¨ã€‚<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ï¼ˆè´Ÿè½½å› å­=æ•°æ®ä¸ªæ•°/å“ˆå¸Œè¡¨é•¿åº¦ï¼‰<br>STEP2.å¯ä»¥å¯¹ç”Ÿæˆçš„å“ˆå¸Œè¡¨è¿›è¡Œæ’å…¥å…ƒç´ ã€æŸ¥æ‰¾å…ƒç´ ã€åˆ é™¤å…ƒç´ çš„æ“ä½œã€‚<br>STEP3.ä¹Ÿå¯ä»¥é€‰æ‹©æ‰©å®¹å½“å‰å“ˆå¸Œè¡¨æˆ–è€…ç”Ÿæˆä¸€ä¸ªç©ºçš„å“ˆå¸Œè¡¨ã€‚
      </p>
      <div class="explain-div" style="top: 50px;">
        <div style="background-color: rgba(60, 192, 115, 0.849);display: inline-block;"></div>--æ“ä½œæˆåŠŸ<br>
        <div style="background-color: #F44336;display: inline-block;"></div>--æ“ä½œå¤±è´¥<br>ï¼ˆæ•°æ®é‡å¤æ’å…¥ï¼‰
      </div>
    </div>
    <div id="hash-main">
      <div id="cover-div">
        <div id="dialog-div">
          <p style="text-align: center;">
            <label
              style="font-size: 22px;color: #000;font-family:'é»‘ä½“' , Arial;font-weight: 600;">åˆå§‹åŒ–å“ˆå¸Œè¡¨<br></label>
            <label style="color: rgb(135, 137, 137);">è¯·è¾“å…¥ä¸€ç»„èŒƒå›´åœ¨0~999çš„æ•°æ®ï¼Œæ¯ä¸ªæ•°æ®ä¹‹é—´ç”¨è‹±æ–‡é€—å·åˆ†éš”ã€‚<br><br></label>
          </p>

          <form id="formH1">
            <div style="display:flex;align-items: center;margin: 20px;"><textarea v-model="inputArray" style="color: white;" placeholder="å¤šä¸ªæ•°æ®ä¹‹é—´ä»¥è‹±æ–‡é€—å·â€˜,â€™åˆ†å‰²"
                class="array-input" />
              <button
                style="border-radius:15px;color: #fff;background-color: #000;outline-style: none;border: 0;padding: 6px;margin-left: 8px;cursor: pointer;"
                @click="arrRandom">
                <span class="icon-spinner11"></span>
              </button>
            </div>
            <label id="errMsg0" style="opacity: 0;;margin-left: 30px ;"></label>
            <input class="button-input" type="button" value="ç¡®å®š" @click="initHash" style="margin-left: 90%;">
          </form>
        </div>
      </div>
      <div id="display-div">
        <button id="back-button" @click="back"
          style="width:fit-content; border: none;outline: none;position:absolute;background:none;color:#FFCC99;font-weight: 600;font-size: 20px;top:0;left: -20px;">è¿”å›</button>
        <div id="hash-options">
          <div id="form-options">
            <div class="horizontal-option">
              <input type="button" value="åˆ›å»ºç©ºè¡¨" @click="unfoldOption(0)">
              <div class="element">
                <p>è¯·è¾“å…¥è¡¨é•¿ï¼š</p>
                <input type="number" v-model="emptySize" :min="3" :max="20" style="width: 80px;display: block;margin-bottom: 10px;">
                <input type="button" value="ç¡®å®š" @click="generateEmpty">
              </div>
            </div>
            <div class="horizontal-option">
              <input type="button" value="æ’å…¥å…ƒç´ " @click="unfoldOption(1)">
              <div class="element">
                <p>è¯·è¾“å…¥è¦æ·»åŠ çš„å…ƒç´ ï¼š</p>
                <button
                  style="border-radius:15px;color: #fff;background-color: #000;outline-style: none;border: 0;padding: 6px;margin-left: 10px;cursor: pointer;"
                  @click="arrRandom">
                  <span class="icon-spinner11"></span>
                </button>
                <input type="text" v-model="inputArray" style="width: 130px;margin-bottom: 5px;">
                <label id="errMsg1" style="font-weight: bolder;"></label>
                <input type="button" value="ç¡®å®š" @click="insertData">
              </div>
            </div>
            <div class="horizontal-option">
              <input type="button" value="æŸ¥æ‰¾å…ƒç´ " @click="unfoldOption(2)">
              <div class="element">
                <p>è¯·è¾“å…¥è¦æŸ¥æ‰¾çš„å…ƒç´ ï¼š</p>
                <button
                  style="border-radius:15px;color: #fff;background-color: #000;outline-style: none;border: 0;padding: 6px;margin-left: 10px;cursor: pointer;"
                  @click="arrRandom">
                  <span class="icon-spinner11"></span>
                </button>
                <input type="text" v-model="inputArray" style="width: 130px;margin-bottom: 5px;">
                <label id="errMsg2" style="font-weight: bolder;"></label>
                <input type="button" value="ç¡®å®š" @click="searchData">
              </div>
            </div>
            <div class="horizontal-option">
              <input type="button" value="åˆ é™¤å…ƒç´ " @click="unfoldOption(3)">
              <div class="element">
                <p>è¯·è¾“å…¥è¦åˆ é™¤çš„å…ƒç´ ï¼š</p>
                <button
                  style="border-radius:15px;color: #fff;background-color: #000;outline-style: none;border: 0;padding: 6px;margin-left: 10px;cursor: pointer;"
                  @click="arrRandom">
                  <span class="icon-spinner11"></span>
                </button>
                <input type="text" v-model="inputArray" style="width: 130px;margin-bottom: 5px;">
                <label id="errMsg3" style="font-weight: bolder;"></label>
                <input type="button" value="ç¡®å®š" @click="deleteData">
              </div>
            </div>
            <div class="horizontal-option">
              <input type="button" value="æ‰©å®¹æ­¤è¡¨" @click="unfoldOption(4)">
              <div class="element">
                <p>è¯·è¾“å…¥æ‰©å®¹åçš„è¡¨é•¿ï¼š</p>
                <input type="number" v-model="newSize" :min="minSize" :max="25" style="width: 80px;display: block; margin-bottom: 10px;">
                <input type="button" value="ç¡®å®š" @click="resize">
              </div>
            </div>
          </div>
        </div>
        <p></p>
        <div id="hash-display">
          <div id="display-table"></div>
        </div>
        <div style="display:flex;justify-content: space-around; align-items: center;">
          <div id="output-info" style="display: flex;flex-direction: column;align-items: center;margin-bottom: 50px;margin-left: 100px;">
            <input id="beginLog" style="background-color: #000;font-size: 15px;color: #fff;margin-bottom: 10px;">
            <input id="completeLog" style="background-color: #000;font-size: 15px;color: #fff;">
          </div>
          <p id="speed-text">1X</p>
          <div style="display: flex;flex-direction: column;align-items: center;">
          <div id="speed-ctrl">
            <button @click="ctrlSpeed('0.5X')">0.5X</button>
            <button @click="ctrlSpeed('1X')">1X</button>
            <button @click="ctrlSpeed('2X')">2X</button>
            <button @click="ctrlSpeed('4X')">4X</button>
          </div>
          <p style="color: #FFCC99;">é€Ÿåº¦è°ƒæ•´å°†ä¼šåœ¨ä¸‹ä¸€ä¸ªæ“ä½œç”Ÿæ•ˆ</p>
          </div>
          <div id="control-btns"></div>
        </div>
      </div>
    </div>
  </div>
</template>

<script>
import $ from 'jquery'
import anime from 'animejs';
import '@/assets/icomoon/style.css'
import {HashTable} from '@/func/HashTable'

export default {
  data() {
    return {
      inputArray:'',
      array:[],
      optionsFlag:[false,false,false,false,false],
      hashObject: {},
      emptySize:3,
      newSize:3,
      minSize:1
    }
  },
  watch: {
  hashObject: function(){
  this.minSize = this.hashObject.getSize()
  this.newSize = this.minSize

  }
  },
  methods: {
    ctrlSpeed(speed){
      $('#speed-text').text(speed)
    },
    warnMsg(index){
      anime({
        targets: '#errMsg'+index,
        color: '#FF1336',
        opacity:[0,1],
      })
    },
    toArray(index) {
      var input = this.inputArray
      this.inputArray=''
      console.log(input)
      if(input){
        if(input == ''){
          $('#errMsg'+index).text('ä½ è¿˜æ²¡æœ‰è¾“å…¥ï¼')
          this.warnMsg(index)
          return false
        }
        for (let i = 0; i < input.length; i++) {
          if(input[i] == 'ï¼Œ'){
            $('#errMsg'+index).text('è¯·ä½¿ç”¨è‹±æ–‡é€—å·ï¼')
            this.warnMsg(index)
            return false
          }
          if((input[i].charCodeAt() < 48 || input[i].charCodeAt() > 57) && input[i] !=','){
            $('#errMsg'+index).text('è¯·è¾“å…¥åœ¨0~999ä»¥å†…çš„æ•´æ•°ï¼')
            this.warnMsg(index)
            return false
          }
        }
        this.array = input.split(',').filter((x) => x !== '')
        if(this.array.length > 26 || this.array.length < 1){
          $('#errMsg'+index).text('è¯·è¾“å…¥1~18ä¸ªæ•°æ®ï¼')
            this.warnMsg(index)
          return false
        }
      }
      else{
        $('#errMsg'+index).text('ä½ è¿˜æ²¡æœ‰è¾“å…¥ï¼')
        this.warnMsg(index)
        return false
      }
        return true
    },
    slideCover(flag){
      if(flag){
        anime({
        targets: '#cover-div',
        translateY: 800,
        easing: 'easeInOutQuad'
        })
        setTimeout(()=>{
          $('#cover-div').css('display','none')
        },1000)
        setTimeout(()=>{
          $('#display-div').css('display','flex')
        },800)
        anime({
          targets: '#display-div',
          translateY:[1000,0],
          easing: 'easeInOutQuad'
        })
    }
    else{
      setTimeout(()=>{$('#cover-div').css('display','flex')},0)
      anime({
      targets: '#cover-div',
      translateY: [800,0],
      easing: 'easeInOutQuad'
      })
      anime({
        targets: '#display-div',
        translateY:[0,1000],
        easing: 'easeInOutQuad'
      })
      setTimeout(()=>{$('#display-div').css('display','none')},500)
    }
    },
    initHash(){
      if(this.toArray(0)){
        this.slideCover(true)
        $('#control-btns').html('<input type="button" id="play" value="ç»§ç»­"><input type="button" id="pause" value="æš‚åœ"><input type="button" id="restart" value="é‡æ¥">')
        this.hashObject = new HashTable(this.array.length, '#display-table')
        this.hashObject.initHashTable(this.array)
        
        anime({
        targets:'#control-btns input',
        opacity: [0,50,100],
        translateX: -50,
        easing: 'easeInOutCirc',
        background: '#FFCC99',
        color: '#000'
        })
      }
      else{
        //this.slideCover(false)
        return
      }
    },
    arrRandom() {
    var len = Math.floor(Math.random() * 20)
    while(len > 18 || len < 2){
      len = Math.floor(Math.random() * 20)
    }
    var arr = new Array(len)
    var rand = 0
    for (var i = 0; i < len; i++) { 
      rand=Math.floor(Math.random() * 1000)
      arr[i] = rand
    } 
      this.inputArray = arr.join(',') 
    },
    unfoldOption(flag){
    let elements = document.querySelectorAll('.element')
      if(this.optionsFlag[flag] == false){
        for (let i = 0; i < this.optionsFlag.length; i++) {
          if(i == flag){
            this.optionsFlag[flag] = true
            anime({
              targets: elements[flag],
              visibility: 'visible',
              opacity: 1,
              height:[0,155],
              easing: 'easeInOutQuad'
            })
            continue
          }
          else{
            if(this.optionsFlag[i] == true)
            {
              this.optionsFlag[i] = false
              anime({
                targets: elements[i],
                opacity: 0,
                height:[155,0],
                easing: 'easeInOutCirc'
              })
            }
          }
          
        }
      }
      else{
        this.optionsFlag[flag] = false
        anime({
          targets: elements[flag],
          opacity:0,
          height:[155,0],
          easing: 'easeInOutCirc'
        })
      }
    },
    generateEmpty(){
      this.unfoldOption(0)
      this.hashObject = new HashTable(this.emptySize,'#display-table')
      this.hashObject.display()
    },
    insertData(){
      if(this.toArray(1))
      {  this.hashObject.setHs(this.array)
        this.unfoldOption(1)}
    },
    searchData(){
      if(this.toArray(2))
      {this.hashObject.searchHs(this.array)
      this.unfoldOption(2)}
    },
    deleteData(){
      if(this.toArray(3))
      {this.hashObject.deleteHs(this.array)
      this.unfoldOption(3)}
    },
    resize(){
      this.unfoldOption(4)
      this.hashObject.resize(this.newSize)
    },
    back(){
      this.slideCover(false)
    }

  },
}
</script>

<style>
#cover-div{
padding-top: 50px;
height: 100%;
width: 100%;
display: flex;
justify-content: center;
flex-direction: column;
align-items: center;
box-sizing: border-box;
}
#dialog-div{
width: fit-content;
box-shadow: 1px 2px 3px rgba(0,0,0,0.2);
background-color: #fff;
}
#formH1 p{
background: #fff;
color: #ffcc99;
padding: 10px;
}
#formH1 input, #formH1 textarea{
background: #000;
color: #fff;
border: none;
display: inline;
}
#formH1 textarea{
width: 493px;
height: 100px;
}
#formH1 label{
padding-right: 10px;
float: left;
}
#display-div{
  width: 90%;
  margin-left: 80px;
  height: 100%;
  position: relative;
  display: none;
  justify-content: center;
  flex-direction: column;
}
#hash-table{
  height: 200px;
  width: 100%;
  display: flex;
  justify-content: center;
  align-items: stretch;
}

#form-options{
  display: flex;
  align-items:flex-start;
  justify-content: center;
}
.horizontal-option{
  display: flex;
  justify-content: center;
  flex-direction: column;
  margin-left: 20px;
  width: 160px;
}
.horizontal-option input:first-child{
  background:#FFCC99;
  border: none;
  outline: none;
}
.element{
  background-color: #000;
  color: #fff;
  padding: 5px;
  opacity: 0;
  border-radius: 5px;
}
#control-btns input{
  margin: 5px;
}
#back-button:before{
  content: "â—„";
  color: #FFCC99;
  height: 10px;
  width: 20px;
  display: inline-block;
}

#speed-ctrl{
display: flex;
flex-direction: row;
}
#speed-ctrl button{
background-color: none;
outline: none;
border: none;
color: #fdb369;
margin-right:5px ;
}
#speed-ctrl button:hover{
box-shadow:1px 2px 4px coral;
}
</style>